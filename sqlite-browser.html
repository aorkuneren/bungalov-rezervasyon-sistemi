<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BungApp - SQLite Database Browser</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        .logo {
            background-color: #1f2937;
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 10px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 15px;
        }
        .title {
            color: #1f2937;
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .subtitle {
            color: #6b7280;
            font-size: 16px;
        }
        .info-box {
            background-color: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .info-title {
            color: #0c4a6e;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .info-text {
            color: #0c4a6e;
            font-size: 14px;
        }
        .table-section {
            margin-bottom: 30px;
        }
        .table-title {
            color: #1f2937;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 2px solid #e5e7eb;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        th {
            background-color: #f9fafb;
            font-weight: bold;
            color: #374151;
        }
        tr:hover {
            background-color: #f9fafb;
        }
        .badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .badge-success {
            background-color: #dcfce7;
            color: #166534;
        }
        .badge-error {
            background-color: #fef2f2;
            color: #dc2626;
        }
        .badge-warning {
            background-color: #fef3c7;
            color: #92400e;
        }
        .badge-info {
            background-color: #dbeafe;
            color: #1e40af;
        }
        .badge-super-admin {
            background-color: #fef2f2;
            color: #dc2626;
        }
        .badge-admin {
            background-color: #dbeafe;
            color: #1e40af;
        }
        .badge-user {
            background-color: #f3f4f6;
            color: #374151;
        }
        .refresh-btn {
            background-color: #1f2937;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-bottom: 20px;
        }
        .refresh-btn:hover {
            background-color: #374151;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">B</div>
            <h1 class="title">BungApp Database Browser</h1>
            <p class="subtitle">SQLite Veritabanƒ± G√∂r√ºnt√ºleyici</p>
        </div>

        <div class="info-box">
            <div class="info-title">üìä Veritabanƒ± Bilgileri</div>
            <div class="info-text">
                <strong>Veritabanƒ±:</strong> SQLite (bungapp_db.sqlite)<br>
                <strong>Konum:</strong> /Users/macmini/Desktop/webadam/backend/database/<br>
                <strong>Durum:</strong> Aktif ve √ßalƒ±≈üƒ±yor<br>
                <strong>Backend API:</strong> http://localhost:8000
            </div>
        </div>

        <button class="refresh-btn" onclick="loadDatabaseData()">üîÑ Verileri Yenile</button>
        <div id="last-update" class="info-text" style="margin-bottom: 20px; text-align: center; color: #6b7280;">
            Son g√ºncelleme: <span id="last-update-time">Y√ºkleniyor...</span>
        </div>

        <div class="table-section">
            <h2 class="table-title">üë• Kullanƒ±cƒ±lar (Users)</h2>
            <table id="users-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Ad</th>
                        <th>E-posta</th>
                        <th>Rol</th>
                        <th>Silinebilir</th>
                        <th>Son Giri≈ü</th>
                        <th>Giri≈ü Sayƒ±sƒ±</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1</td>
                        <td>Super Admin</td>
                        <td>info@aorkuneren.com</td>
                        <td><span class="badge badge-super-admin">Super Admin</span></td>
                        <td><span class="badge badge-error">Hayƒ±r</span></td>
                        <td>2025-10-14 15:17:26</td>
                        <td>3</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>Admin</td>
                        <td>info@adenbungalov.com</td>
                        <td><span class="badge badge-admin">Admin</span></td>
                        <td><span class="badge badge-success">Evet</span></td>
                        <td>2025-10-14 15:17:32</td>
                        <td>1</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="table-section">
            <h2 class="table-title">üìù Son Aktiviteler (Activity Logs)</h2>
            <table id="activity-logs-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Kullanƒ±cƒ±</th>
                        <th>ƒ∞≈ülem</th>
                        <th>Durum</th>
                        <th>IP</th>
                        <th>Tarih</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>6</td>
                        <td>Super Admin</td>
                        <td>Hatalƒ± Giri≈ü</td>
                        <td><span class="badge badge-error">Hata</span></td>
                        <td>127.0.0.1</td>
                        <td>2025-10-14 15:17:38</td>
                    </tr>
                    <tr>
                        <td>5</td>
                        <td>Admin</td>
                        <td>Giri≈ü Yapƒ±ldƒ±</td>
                        <td><span class="badge badge-success">Ba≈üarƒ±lƒ±</span></td>
                        <td>127.0.0.1</td>
                        <td>2025-10-14 15:17:32</td>
                    </tr>
                    <tr>
                        <td>4</td>
                        <td>Super Admin</td>
                        <td>Giri≈ü Yapƒ±ldƒ±</td>
                        <td><span class="badge badge-success">Ba≈üarƒ±lƒ±</span></td>
                        <td>127.0.0.1</td>
                        <td>2025-10-14 15:17:26</td>
                    </tr>
                    <tr>
                        <td>3</td>
                        <td>Super Admin</td>
                        <td>Giri≈ü Yapƒ±ldƒ±</td>
                        <td><span class="badge badge-success">Ba≈üarƒ±lƒ±</span></td>
                        <td>127.0.0.1</td>
                        <td>2025-10-14 15:17:06</td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>Super Admin</td>
                        <td>≈ûifre Sƒ±fƒ±rlama ƒ∞stendi</td>
                        <td><span class="badge badge-success">Ba≈üarƒ±lƒ±</span></td>
                        <td>127.0.0.1</td>
                        <td>2025-10-14 15:15:17</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="table-section">
            <h2 class="table-title">üè† Bungalovlar (Bungalows)</h2>
            <table id="bungalows-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Ad</th>
                        <th>Kapasite</th>
                        <th>A√ßƒ±klama</th>
                        <th>Gecelik Fiyat</th>
                        <th>Durum</th>
                        <th>Olu≈üturulma</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>5</td>
                        <td>Aden Garden Suit No.1</td>
                        <td>2 ki≈üi</td>
                        <td>Sadece Bah√ßeli</td>
                        <td>‚Ç∫5000</td>
                        <td><span class="badge badge-success">Aktif</span></td>
                        <td>2025-10-14 15:37:00</td>
                    </tr>
                    <tr>
                        <td>6</td>
                        <td>Aden Garden Suit No.2</td>
                        <td>2 ki≈üi</td>
                        <td>Sadece Bah√ßeli</td>
                        <td>‚Ç∫5000</td>
                        <td><span class="badge badge-success">Aktif</span></td>
                        <td>2025-10-14 15:37:00</td>
                    </tr>
                    <tr>
                        <td>7</td>
                        <td>Aden Garden Suit No.3</td>
                        <td>2 ki≈üi</td>
                        <td>D√∂rtgen Havuz</td>
                        <td>‚Ç∫5000</td>
                        <td><span class="badge badge-success">Aktif</span></td>
                        <td>2025-10-14 15:37:00</td>
                    </tr>
                    <tr>
                        <td>8</td>
                        <td>Aden Family Suit No.4</td>
                        <td>4 ki≈üi</td>
                        <td>Yuvarlak Havuz</td>
                        <td>‚Ç∫5000</td>
                        <td><span class="badge badge-success">Aktif</span></td>
                        <td>2025-10-14 15:37:00</td>
                    </tr>
                    <tr>
                        <td>9</td>
                        <td>Aden Family Suit No.5</td>
                        <td>4 ki≈üi</td>
                        <td>Sƒ±cak Yuvarlak Havuz</td>
                        <td>‚Ç∫8000</td>
                        <td><span class="badge badge-success">Aktif</span></td>
                        <td>2025-10-14 15:37:00</td>
                    </tr>
                    <tr>
                        <td>10</td>
                        <td>Aden Family Suit No.6</td>
                        <td>2 ki≈üi</td>
                        <td>Yuvarlak Havuz</td>
                        <td>‚Ç∫5000</td>
                        <td><span class="badge badge-success">Aktif</span></td>
                        <td>2025-10-14 15:37:00</td>
                    </tr>
                    <tr>
                        <td>11</td>
                        <td>Aden Blue Suit No.7</td>
                        <td>2 ki≈üi</td>
                        <td>Sƒ±cak Yuvarlak Havuz</td>
                        <td>‚Ç∫8000</td>
                        <td><span class="badge badge-success">Aktif</span></td>
                        <td>2025-10-14 15:37:00</td>
                    </tr>
                    <tr>
                        <td>12</td>
                        <td>Aden Blue Suit No.8</td>
                        <td>2 ki≈üi</td>
                        <td>Yuvarlak Havuz</td>
                        <td>‚Ç∫8000</td>
                        <td><span class="badge badge-success">Aktif</span></td>
                        <td>2025-10-14 15:37:00</td>
                    </tr>
                    <tr>
                        <td>13</td>
                        <td>Aden White Suit No.9</td>
                        <td>2 ki≈üi</td>
                        <td>Sƒ±cak D√∂rtgen Havuz</td>
                        <td>‚Ç∫8000</td>
                        <td><span class="badge badge-success">Aktif</span></td>
                        <td>2025-10-14 15:37:00</td>
                    </tr>
                    <tr>
                        <td>14</td>
                        <td>Aden White Suit No.10</td>
                        <td>2 ki≈üi</td>
                        <td>Sƒ±cak D√∂rtgen Havuz</td>
                        <td>‚Ç∫8000</td>
                        <td><span class="badge badge-success">Aktif</span></td>
                        <td>2025-10-14 15:37:00</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="table-section">
            <h2 class="table-title">üè¢ Firma Ayarlarƒ± (Company Settings)</h2>
            <table id="company-settings-table">
                <thead>
                    <tr>
                        <th>Firma Adƒ±</th>
                        <th>T√ºr</th>
                        <th>Vergi No</th>
                        <th>Telefon</th>
                        <th>E-posta</th>
                        <th>G√ºncellenme</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="6" style="text-align: center; color: #6b7280; font-style: italic;">
                            Y√ºkleniyor...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="table-section">
            <h2 class="table-title">üìã Rezervasyon Ayarlarƒ± (Reservation Settings)</h2>
            <table id="reservation-settings-table">
                <thead>
                    <tr>
                        <th>Giri≈ü Saati</th>
                        <th>√áƒ±kƒ±≈ü Saati</th>
                        <th>Min. Konaklama</th>
                        <th>Kapora</th>
                        <th>ƒ∞ptal S√ºresi</th>
                        <th>G√ºncellenme</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="6" style="text-align: center; color: #6b7280; font-style: italic;">
                            Y√ºkleniyor...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="table-section">
            <h2 class="table-title">üîê ≈ûifre Sƒ±fƒ±rlama Tokenlarƒ±</h2>
            <table id="password-reset-tokens-table">
                <thead>
                    <tr>
                        <th>E-posta</th>
                        <th>Token</th>
                        <th>Olu≈üturulma Tarihi</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="3" style="text-align: center; color: #6b7280; font-style: italic;">
                            ≈ûu anda aktif token bulunmuyor
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="info-box">
            <div class="info-title">üîó Eri≈üim Linkleri</div>
            <div class="info-text">
                <strong>Frontend:</strong> <a href="http://localhost:3000" target="_blank">http://localhost:3000</a><br>
                <strong>Backend API:</strong> <a href="http://localhost:8000" target="_blank">http://localhost:8000</a><br>
                <strong>API Dok√ºmantasyonu:</strong> <a href="http://localhost:8000/api" target="_blank">http://localhost:8000/api</a>
            </div>
        </div>
    </div>

    <script>
        // Veritabanƒ± verilerini y√ºkle
        async function loadDatabaseData() {
            try {
                const response = await fetch('http://localhost:8000/api/database-browser');
                const result = await response.json();
                
                if (result.success) {
                    updateTables(result.data);
                    document.getElementById('last-update-time').textContent = result.timestamp;
                } else {
                    console.error('Veri y√ºkleme hatasƒ±:', result.message);
                }
            } catch (error) {
                console.error('API √ßaƒürƒ±sƒ± hatasƒ±:', error);
                document.getElementById('last-update-time').textContent = 'Hata: ' + error.message;
            }
        }

        // Tablolarƒ± g√ºncelle
        function updateTables(data) {
            updateUsersTable(data.users);
            updateActivityLogsTable(data.activity_logs);
            updateBungalowsTable(data.bungalows);
            updateCompanySettingsTable(data.company_settings);
            updateReservationSettingsTable(data.reservation_settings);
            updatePasswordResetTokensTable(data.password_reset_tokens);
        }

        // Kullanƒ±cƒ±lar tablosunu g√ºncelle
        function updateUsersTable(users) {
            const tbody = document.querySelector('#users-table tbody');
            if (!tbody) return;
            
            tbody.innerHTML = users.map(user => `
                <tr>
                    <td>${user.id}</td>
                    <td>${user.name}</td>
                    <td>${user.email}</td>
                    <td><span class="badge badge-${user.role}">${getRoleDisplayName(user.role)}</span></td>
                    <td><span class="badge ${user.is_deletable ? 'badge-success' : 'badge-error'}">${user.is_deletable ? 'Evet' : 'Hayƒ±r'}</span></td>
                    <td>${user.last_login_at || 'Hi√ß giri≈ü yapmamƒ±≈ü'}</td>
                    <td>${user.login_count}</td>
                </tr>
            `).join('');
        }

        // Aktivite loglarƒ± tablosunu g√ºncelle
        function updateActivityLogsTable(logs) {
            const tbody = document.querySelector('#activity-logs-table tbody');
            if (!tbody) return;
            
            tbody.innerHTML = logs.map(log => `
                <tr>
                    <td>${log.id}</td>
                    <td>${log.user_name}</td>
                    <td>${log.action}</td>
                    <td><span class="badge badge-${log.status}">${getStatusDisplayName(log.status)}</span></td>
                    <td>${log.ip}</td>
                    <td>${log.created_at}</td>
                </tr>
            `).join('');
        }

        // Bungalovlar tablosunu g√ºncelle
        function updateBungalowsTable(bungalows) {
            const tbody = document.querySelector('#bungalows-table tbody');
            if (!tbody) return;
            
            tbody.innerHTML = bungalows.map(bungalow => `
                <tr>
                    <td>${bungalow.id}</td>
                    <td>${bungalow.name}</td>
                    <td>${bungalow.capacity}</td>
                    <td>${bungalow.description}</td>
                    <td>${bungalow.price_per_night}</td>
                    <td><span class="badge badge-success">${bungalow.status}</span></td>
                    <td>${bungalow.created_at}</td>
                </tr>
            `).join('');
        }

        // Firma ayarlarƒ± tablosunu g√ºncelle
        function updateCompanySettingsTable(settings) {
            const tbody = document.querySelector('#company-settings-table tbody');
            if (!tbody) return;
            
            if (settings) {
                tbody.innerHTML = `
                    <tr>
                        <td>${settings.company_name || 'Belirtilmemi≈ü'}</td>
                        <td>${settings.company_type || 'Belirtilmemi≈ü'}</td>
                        <td>${settings.tax_number || 'Belirtilmemi≈ü'}</td>
                        <td>${settings.phone || 'Belirtilmemi≈ü'}</td>
                        <td>${settings.email || 'Belirtilmemi≈ü'}</td>
                        <td>${settings.updated_at}</td>
                    </tr>
                `;
            } else {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; color: #6b7280; font-style: italic;">
                            Hen√ºz firma bilgileri kaydedilmemi≈ü
                        </td>
                    </tr>
                `;
            }
        }

        // Rezervasyon ayarlarƒ± tablosunu g√ºncelle
        function updateReservationSettingsTable(settings) {
            const tbody = document.querySelector('#reservation-settings-table tbody');
            if (!tbody) return;
            
            if (settings) {
                tbody.innerHTML = `
                    <tr>
                        <td>${settings.check_in_time}</td>
                        <td>${settings.check_out_time}</td>
                        <td>${settings.min_stay_days} g√ºn</td>
                        <td>‚Ç∫${settings.deposit_amount}</td>
                        <td>${settings.cancellation_days} g√ºn</td>
                        <td>${settings.updated_at}</td>
                    </tr>
                `;
            } else {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; color: #6b7280; font-style: italic;">
                            Hen√ºz rezervasyon ayarlarƒ± kaydedilmemi≈ü
                        </td>
                    </tr>
                `;
            }
        }

        // ≈ûifre sƒ±fƒ±rlama tokenlarƒ± tablosunu g√ºncelle
        function updatePasswordResetTokensTable(tokens) {
            const tbody = document.querySelector('#password-reset-tokens-table tbody');
            if (!tbody) return;
            
            if (tokens && tokens.length > 0) {
                tbody.innerHTML = tokens.map(token => `
                    <tr>
                        <td>${token.email}</td>
                        <td>${token.token}</td>
                        <td>${token.created_at}</td>
                    </tr>
                `).join('');
            } else {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="3" style="text-align: center; color: #6b7280; font-style: italic;">
                            ≈ûu anda aktif token bulunmuyor
                        </td>
                    </tr>
                `;
            }
        }

        // Yardƒ±mcƒ± fonksiyonlar
        function getRoleDisplayName(role) {
            const roles = {
                'super_admin': 'Super Admin',
                'admin': 'Admin',
                'user': 'Kullanƒ±cƒ±'
            };
            return roles[role] || role;
        }

        function getStatusDisplayName(status) {
            const statuses = {
                'success': 'Ba≈üarƒ±lƒ±',
                'error': 'Hata',
                'warning': 'Uyarƒ±',
                'info': 'Bilgi'
            };
            return statuses[status] || status;
        }

        // Sayfa y√ºklendiƒüinde verileri y√ºkle
        document.addEventListener('DOMContentLoaded', function() {
            loadDatabaseData();
            
            // Her 30 saniyede bir otomatik g√ºncelle
            setInterval(loadDatabaseData, 30000);
        });
    </script>
</body>
</html>
